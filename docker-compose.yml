version: '3'
services: 
  discovery1:
    command: bash -c 'java -Dspring.profiles.active=discovery1 -jar /app.jar'
    container_name: discovery1
    image: org.rizki.mufrizal.discovery.service/discovery-service
    ports: 
      - 10001:10001
    networks: 
      main:
        aliases: 
          - discovery1

  discovery2:
    command: bash -c 'java -Dspring.profiles.active=discovery2 -jar /app.jar'
    container_name: discovery2
    image: org.rizki.mufrizal.discovery.service/discovery-service
    ports: 
      - 10002:10002
    networks: 
      main:
        aliases: 
          - discovery2

  configurationserver:
    command: bash -c 'java -jar /app.jar'
    container_name: configurationserver
    image: org.rizki.mufrizal.configuration.server/configuration-server
    networks: 
      main:
        aliases: 
          - configurationserver

  postgrescatalog:
    container_name: postgrescatalog
    image: postgres:latest
    environment:
      POSTGRES_USER: postgrescatalog
      POSTGRES_PASSWORD: postgrescatalog
      POSTGRES_DB: db_catalog
    networks: 
      main:
        aliases: 
          - postgrescatalog

  catalogservice:
    command: bash -c 'sleep 120 && java -jar /app.jar'
    container_name: catalogservice
    image: org.rizki.mufrizal.catalog.service/catalog-service
    networks: 
      main:
        aliases: 
          - catalogservice

  mongotransaction:
    container_name: mongotransaction
    image: mongo:latest
    networks: 
      main:
        aliases: 
          - mongotransaction

  transactionservice:
    command: bash -c 'sleep 120 && java -jar /app.jar'
    container_name: transactionservice
    image: org.rizki.mufrizal.transaction.service/transaction-service
    networks: 
      main:
        aliases: 
          - transactionservice

  mariadboauth2:
    container_name: mariadboauth2
    image: mariadb:latest
    environment:
      MYSQL_ROOT_PASSWORD: mariadboauth2
      MYSQL_USER: mariadboauth2
      MYSQL_PASSWORD: mariadboauth2
      MYSQL_DATABASE: db_oauth2
    networks: 
      main:
        aliases: 
          - mariadboauth2

  redissessionoauth2:
    container_name: redissessionoauth2
    image: bitnami/redis:latest
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    networks: 
      main:
        aliases: 
          - redissessionoauth2

  oauth2service:
    command: bash -c 'sleep 120 && java -jar /app.jar'
    container_name: oauth2service
    image: org.rizki.mufrizal.oauth2.service/oauth2-service
    networks: 
      main:
        aliases: 
          - oauth2service

  apigateway:
    command: bash -c 'sleep 120 && java -jar /app.jar'
    container_name: apigateway
    image: org.rizki.mufrizal.api.gateway/api-gateway
    ports: 
      - 8080:8080
    networks: 
      main:
        aliases: 
          - apigateway

networks: 
  main: